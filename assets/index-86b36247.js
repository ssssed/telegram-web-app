import{j as s,r as h,u as N,a as b,b as C,c as y}from"./index-3e243a46.js";import{u as x,a as _,b as v}from"./axios-e620c505.js";const M=t=>{const n=t.getHours(),e=t.getMinutes();return`${n}:${e}`};const k=({avatar:t,name:n,message:e,order:a,onClick:c})=>s.jsxs("div",{className:"chat-header",children:[s.jsx("img",{className:"chat-header__img",src:t}),s.jsxs("div",{className:"chat-header__info",children:[s.jsx("h3",{className:"chat-header__title",children:n}),s.jsxs("p",{className:"chat-header__text",children:["работает над заявкой ",a]})]}),s.jsxs("button",{className:"chat-header__button",onClick:c,children:["Вернуться к диалогам",e?s.jsx("div",{className:"chat-header__button-message",children:e}):""]})]}),$="/telegram-web-app/assets/clip-55921f01.svg";const w=({onChange:t})=>{const n=h.useRef(null),e=()=>{var a;n&&((a=n.current)==null||a.click())};return s.jsxs("div",{className:"chat-file",children:[s.jsx("input",{type:"file",onChange:t,ref:n,style:{display:"none"}}),s.jsx("img",{className:"chat-file__img",onClick:e,src:$,alt:"clip"})]})};const F=({file_name:t,message:n,className:e,children:a})=>s.jsxs("div",{className:`chat-message chat-message${e}`,children:[s.jsxs("div",{className:"chat-message__info",children:[s.jsx("p",{className:"chat-message__text",children:n}),s.jsx("span",{className:"chat-message__file-name",children:t})]}),a]});const q=({children:t,onClick:n})=>s.jsx("button",{className:"chat-message__button",onClick:n,children:t}),j=({children:t,prefix:n,time:e})=>s.jsxs("div",{className:"chat-message__status",children:[s.jsx("span",{className:`chat-message__time chat-message__time${n}`,children:e}),t]}),I=()=>{const t=N(),n=x(),e=()=>{n(b()),t("/")},{selectedChat:a,chats:c}=_(l=>l.chat);return s.jsx(k,{avatar:a.user_avatar,name:a.user_name,order:a.title,message:c-1,onClick:e})},S="/telegram-web-app/assets/close-dd15b66d.svg",D="_container_72q7t_1",E="_file_72q7t_9",W="_content_72q7t_16",H="_input_72q7t_27",R="_send_72q7t_38",A="_close_72q7t_49",O="_img_72q7t_57",m={container:D,file:E,content:W,input:H,send:R,close:A,img:O},T=()=>{const[t,n]=h.useState(""),[e,a]=h.useState(null),c=x(),l=i=>n(i.target.value),f=i=>{var r;const p=(r=i.target.files)==null?void 0:r.item(0);p&&a(p)},g=()=>a(null),o=async i=>{i.preventDefault();const p=M(new Date),r={message:t,time:p,author:"user"},d=new FormData;if(e){d.append("file",e),d.append("originalName",e.name),r.file_name=e.name;try{const{data:u}=await v.post("http://localhost:8000/v1/api/upload",d);r.fileName=u.fileName,u.fileOriginalName&&(r.file_original_name=u.fileOriginalName),console.log("data",u),console.log("answer",r)}catch(u){alert(u)}}d.append("message",t),d.append("time",p),d.append("author","user"),c(C(r)),n(""),a(null)};return s.jsxs("form",{className:m.container,onSubmit:o,children:[s.jsxs("div",{className:m.content,children:[e&&s.jsxs("div",{className:m.file,children:[s.jsx("span",{children:e.name}),s.jsx("div",{className:m.close,children:s.jsx("img",{src:S,className:m.img,alt:"close",onClick:g})})]}),s.jsx("input",{className:m.input,placeholder:"Напишите сообщение",value:t,onChange:l}),s.jsx(w,{onChange:f})]}),s.jsx("button",{type:"submit",className:m.send,children:"Отправить"})]})},B="/telegram-web-app/assets/checkmark-1f343b7b.svg",G=({hasFile:t,isMyMessage:n,prefix:e,time:a,message:c})=>{const l=N(),f=()=>{if(g==="Загрузить файл"){const o=document.createElement("a");o.href=`http://localhost:8000/${c.fileName}`,o.download=c.file_name||"Файл",o.click();return}l(`/file/${c.fileName}`)},g=h.useMemo(()=>{var i;const o=((i=c.file_name)==null?void 0:i.split(".").at(-1))||"";return["pdf","png","jpeg","jpg"].includes(o)?"Посмотреть файл":"Загрузить файл"},[c.file_name]);return t?s.jsx(q,{onClick:f,children:g}):n?s.jsx(j,{prefix:e,time:a,children:s.jsx("img",{className:"chat-message__img",src:B,alt:"checkmark"})}):s.jsx(j,{prefix:e,time:a})};const P=h.memo(()=>{const{messages:t}=_(e=>e.chat),{selectedChat:n}=_(e=>e.chat);return s.jsx("div",{className:"messages",children:t.map(e=>{const a=e.author!==n.user_name,c=!!e.file_name,l=a?"_my":"_intervier";return s.jsx(F,{className:l,message:e.message,author:e.author,time:e.time,file_name:e.file_name,children:s.jsx(G,{prefix:l,message:e,time:e.time,isMyMessage:a,hasFile:c})},e.time)})})});const K=()=>{const{selectedChat:t}=_(a=>a.chat),n=x(),e=h.useCallback(async()=>{const{data:a}=await v.post("http://localhost:8000/v1/api/messages",{userId:0,chatId:t.id,recruiterId:0});a.status===200&&n(y(a.messages))},[]);return h.useEffect(()=>{e()},[e]),s.jsxs("div",{className:"chat",children:[s.jsx(I,{}),s.jsx("hr",{color:"#d9d9d9"}),s.jsx(P,{}),s.jsx(T,{})]})};export{K as default};
